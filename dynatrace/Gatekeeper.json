{"version":14,"variables":[],"tiles":{"0":{"type":"markdown","title":"","content":"**GateKeeper Policies**"},"1":{"type":"data","title":"Number of Constraints","query":"timeseries sum(gatekeeper_constraints), by: { status}","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"pieChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"status","valueAxis":"interval","categoryAxisLabel":"status","valueAxisLabel":"interval"},"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["sum(gatekeeper_constraints)"],"leftAxisDimensions":["status"]},"hiddenLegendFields":[]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"enforcement_action","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"status","value":"status"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"2":{"type":"data","title":"Number of Constraints template","query":"timeseries sum(gatekeeper_constraint_templates), by: { status}","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"pieChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"status","valueAxis":"interval","categoryAxisLabel":"status","valueAxisLabel":"interval"},"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["sum(gatekeeper_constraint_templates)"],"leftAxisDimensions":["status"]},"hiddenLegendFields":[]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"enforcement_action","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"status","value":"status"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"4":{"type":"data","title":"Number of Constraints","query":"timeseries sum(gatekeeper_constraints), by: { enforcement_action}","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"enforcement_action","valueAxis":"interval","categoryAxisLabel":"enforcement_action","valueAxisLabel":"interval"},"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["sum(gatekeeper_constraints)"],"leftAxisDimensions":["enforcement_action"]},"hiddenLegendFields":[]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"enforcement_action","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"enforcement_action","value":"enforcement_action"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"5":{"type":"markdown","title":"","content":"Webhook"},"6":{"type":"data","title":"Number of validation request per min","query":"timeseries total=sum(gatekeeper_validation_request_count_total), by:{admission_status}\n| fieldsAdd totalpers=total[]/todouble(interval/1m)\n| fieldsRemove total","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["totalpers"],"leftAxisDimensions":["admission_status"]},"categoricalBarChartSettings":{"categoryAxis":"admission_status","valueAxis":"interval","categoryAxisLabel":"admission_status","valueAxisLabel":"interval"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"admission_status","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"admission_status","value":"admission_status"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"7":{"type":"data","title":"average validation response time","query":"timeseries nbrecords=sum(gatekeeper_validation_request_duration_seconds_count),total=avg(gatekeeper_validation_request_duration_seconds_sum), by:{admission_status}\n| fieldsAdd  response_time=total[]/nbrecords[]\n| fieldsRemove nbrecords, total","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["response_time"],"leftAxisDimensions":["admission_status"]},"categoricalBarChartSettings":{"categoryAxis":"admission_status","valueAxis":"interval","categoryAxisLabel":"admission_status","valueAxisLabel":"interval"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"admission_status","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"admission_status","value":"admission_status"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"8":{"type":"data","title":"Number of mutation request per min","query":"timeseries total=sum(gatekeeper_mutation_request_count_total), by:{admission_status}\n| fieldsAdd totalpers=total[]/todouble(interval/1m)\n| fieldsRemove total","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["totalpers"],"leftAxisDimensions":[]},"categoricalBarChartSettings":{"categoryAxisLabel":"admission_status","valueAxisLabel":"interval"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"admission_status","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"9":{"type":"data","title":"average mutationresponse time","query":"timeseries nbrecords=sum(gatekeeper_mutation_request_duration_seconds_count),total=avg(gatekeeper_mutation_request_duration_seconds_sum), by:{admission_status}\n| fieldsAdd  response_time=total[]/nbrecords[]\n| fieldsRemove nbrecords, total","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["response_time"],"leftAxisDimensions":[]},"categoricalBarChartSettings":{"categoryAxisLabel":"admission_status","valueAxisLabel":"interval"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"admission_status","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"10":{"type":"markdown","title":"","content":"Resource usage"},"11":{"type":"data","title":"CPu usage Controller manager","query":"timeseries cpu_usages = avg(dt.kubernetes.container.cpu_usage), by:{ k8s.workload.name, k8s.pod.name}\n| fieldsAdd cpu_usage = cpu_usages[] \n|filter contains(k8s.workload.name,\"gatekeeper-controller\")\n| fieldsRemove cpu_usages","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"k8s.workload.name","valueAxis":"interval","categoryAxisLabel":"k8s.workload.name","valueAxisLabel":"interval"},"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["cpu_usage"],"leftAxisDimensions":["k8s.workload.name","k8s.pod.name"]},"hiddenLegendFields":["k8s.workload","k8s.pod"]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"k8s.workload.name"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"k8s.workload.name","value":"k8s.pod.name"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"lineChart"},"12":{"type":"data","title":"Memory Usage Controller manager","query":"timeseries usage=avg(dt.kubernetes.container.memory_working_set), by:{ k8s.workload.name,k8s.pod.name}\n| filter contains(k8s.workload.name,\"gatekeeper-controller\")","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"k8s.workload.name","categoryAxisLabel":"k8s.workload.name","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":["k8s.workload","k8s.pod"],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["usage"],"leftAxisDimensions":["k8s.workload.name","k8s.pod.name"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"k8s.workload.name","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"k8s.workload.name","value":"k8s.pod.name"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"13":{"type":"data","title":"CPu usage Audit","query":"timeseries cpu_usages = avg(dt.kubernetes.container.cpu_usage), by:{ k8s.workload.name, k8s.pod.name}\n| fieldsAdd cpu_usage = cpu_usages[] \n|filter contains(k8s.workload.name,\"gatekeeper-audit\")\n| fieldsRemove cpu_usages","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"k8s.workload.name","valueAxis":"interval","categoryAxisLabel":"k8s.workload.name","valueAxisLabel":"interval"},"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["cpu_usage"],"leftAxisDimensions":["k8s.workload.name","k8s.pod.name"]},"hiddenLegendFields":["k8s.workload","k8s.pod"]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","colorThresholdTarget":"value","recordField":"k8s.workload.name"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"k8s.workload.name","value":"k8s.pod.name"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"lineChart"},"14":{"type":"data","title":"Memory Usage Audit","query":"timeseries usage=avg(dt.kubernetes.container.memory_working_set), by:{ k8s.workload.name,k8s.pod.name}\n| filter contains(k8s.workload.name,\"gatekeeper-audit\")","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"k8s.workload.name","categoryAxisLabel":"k8s.workload.name","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":["k8s.workload","k8s.pod"],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["usage"],"leftAxisDimensions":["k8s.workload.name","k8s.pod.name"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"k8s.workload.name","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"k8s.workload.name","value":"k8s.pod.name"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"15":{"type":"markdown","title":"","content":"Log analytics"},"16":{"type":"data","title":"Number of Violation per constraint","query":" fetch logs\n| filter k8s.namespace.name == \"gatekeeper\"\n| filter opa.process != \"audit\"\n| filter isNotNull(opa.constraint.kind)\n| summarize count(), by:{bin(timestamp, 30s),opa.constraint.kind}","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"opa.constraint.kind","categoryAxisLabel":"opa.constraint.kind","valueAxis":"count()","valueAxisLabel":"count()"},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"bin(timestamp, 30s)","leftAxisValues":["count()"],"leftAxisDimensions":["opa.constraint.kind"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"bin(timestamp, 30s)","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"opa.constraint.kind","value":"bin(timestamp, 30s)"}},"histogram":{"dataMappings":[{"valueAxis":"count()","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"17":{"type":"data","title":"","query":" fetch logs\n| filter k8s.namespace.name == \"gatekeeper\"\n| filter opa.process != \"audit\"\n| filter isNotNull(opa.constraint.kind)\n| filter isNotNull(opa.resource.namespace)\n| summarize number_of_violation=count(), by:{opa.constraint.kind,opa.resource.namespace}\n| sort number_of_violation desc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"opa.constraint.kind","categoryAxisLabel":"opa.constraint.kind","valueAxis":"number_of_violation","valueAxisLabel":"number_of_violation"},"hiddenLegendFields":[]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"bin(timestamp, 30s)","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"opa.resource.namespace\"]":108.671875,"[\"opa.constraint.kind\"]":308.5}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"opa.constraint.kind","value":"opa.resource.namespace"}},"histogram":{"dataMappings":[{"valueAxis":"number_of_violation","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}}},"layouts":{"0":{"x":0,"y":0,"w":24,"h":1},"1":{"x":0,"y":1,"w":7,"h":5},"2":{"x":16,"y":1,"w":8,"h":5},"4":{"x":7,"y":1,"w":9,"h":5},"5":{"x":0,"y":6,"w":24,"h":1},"6":{"x":0,"y":7,"w":12,"h":5},"7":{"x":12,"y":7,"w":12,"h":5},"8":{"x":0,"y":12,"w":12,"h":5},"9":{"x":12,"y":12,"w":12,"h":5},"10":{"x":0,"y":17,"w":24,"h":1},"11":{"x":0,"y":18,"w":13,"h":4},"12":{"x":13,"y":18,"w":11,"h":4},"13":{"x":0,"y":22,"w":13,"h":4},"14":{"x":13,"y":22,"w":11,"h":4},"15":{"x":0,"y":26,"w":24,"h":1},"16":{"x":0,"y":27,"w":13,"h":5},"17":{"x":13,"y":27,"w":11,"h":5}},"importedWithCode":false}